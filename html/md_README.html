<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1 align="center">Previs√µes utilizando Grafos </h1>
<p>Este reposit√≥rio cont√©m a implementa√ß√£o de uma forma primitiva e amadora de realizar previs√µes sobre qual time sairia vencedor em uma partida de futebol, envolvendo todos os times presentes na s√©rie A.</p>
<h2 align="center">‚ö†Ô∏è <b> <em> Problem√°tica </em> </b> </h2>
<p>Sabe-se que no futebol, uma das grandes ind√∫strias que crescem √© voltada para o mercado de apostas, sendo uma fonte consideravelmente forte de renda extra. Entretanto, enquanto humanos, √© comum desconsiderar alguns fatores essenciais ao realizar uma aposta por puro esquecimento de estat√≠stica X ou Y. Pensando nisso, o programa foi criado como uma forma de juntar todas as estat√≠sticas importantes para o processo de decis√£o para um resultado, apresentando uma previs√£o decidida por meio da an√°lise de todas as informa√ß√µes coletadas por meio de sites voltados ao mundo futibol√≠stico.</p>
<h2 align="center">‚öôÔ∏è <b> <em>Tecnologias utilizadas</em> </b> </h2>
<table align="center">
<tr>
<td><b>Tecnologia</b> </td><td><b>Vers√£o</b>  </td></tr>
<tr>
<td>Python </td><td>3.10.6  </td></tr>
<tr>
<td>pandas </td><td>1.5.1  </td></tr>
<tr>
<td>numpy </td><td>1.23.4  </td></tr>
<tr>
<td>requests </td><td>2.28.1  </td></tr>
<tr>
<td>lxml </td><td>4.9.1  </td></tr>
<tr>
<td>openpyxl </td><td>3.0.10  </td></tr>
<tr>
<td>networkx </td><td>2.8.8  </td></tr>
<tr>
<td>matplotlib </td><td>3.6.2  </td></tr>
</table>
<h2 align="center">üî¨ <b> <em>Dados levados em considera√ß√£o</em> </b> </h2>
<p>Essa √© a vers√£o inicial de um projeto que poss√≠velmente pode ter sequ√™ncia, sendo assim, o programa conta com apenas um tipo de dado levado em considera√ß√£o:</p><ul>
<li>Coloca√ß√µes nos 5 anos anteriores da competi√ß√£o.</li>
</ul>
<p>√â plaus√≠vel ainda salientar que houve o desejo de adicionar o m√©rito do confronto direto entre ambos os times que estariam em duelo, entretanto, a fonte encontrada para a desejada informa√ß√£o n√£o aceitava a quantidade de requisi√ß√µes necess√°rias pelo programa. Ao entrar em contato com o site em quest√£o, solicitando uma libera√ß√£o ou se havia a exist√™ncia de uma API, n√£o houve retorno.</p>
<h2 align="center">üí°<b> <em>Algoritmo </em> </b> </h2>
<p>&lt;d1&gt; </p>
<p>1. Realizar a coleta de informa√ß√µes desejadas por meio de Web Scraping;  </p>
<p>2. Salvar as informa√ß√µes no programa para uso posterior;  </p>
<p>3. Aplicar a aritm√©tica considerada eficiente aos dados coletados;  </p>
<p>4. Utilizar grafos a fim de organizar as informa√ß√µes da forma desejada;  </p>
<p>5. Solicitar ao usu√°rio que informe qual ser√° o confronto;  </p>
<p>6. Informar ao usu√°rio qual o time que <b>PROVAVELMENTE</b> vencer√° o confronto, utilizando os dados j√° armazenados no programa.  &lt;/d1&gt;</p>
<h2 align="center">üñ•Ô∏è<b> <em>Implementa√ß√£o</em> </b> </h2>
<p>Inicialmente, seguindo o que foi pontuado no detalhamento do algoritmo, o primeiro passo foi realizar a coleta de informa√ß√µes. Para esse est√°gio, foram utilizadas as bibliotecas <b>pandas</b>, <b>requests</b>, <b>openpyxl</b> e <b>lxml</b>, sendo cada uma delas extremamente importante para cada fase dessa coleta:</p><ul>
<li><b>Pandas</b> ser√° utilizado a fim de trabalhar com todo o conte√∫do HTML em dataframes;</li>
<li><b>Requests</b> foi utilizado como uma forma segura de realizar as requisi√ß√µes para o Web Scraping a fim de minimizar as chances de erros;</li>
<li><b>Openpyxl</b> e <b>lxml</b> serviu o prop√≥sito de salvar todos os dados coletados, ap√≥s serem tratados, em arquivos **.xlsx**.</li>
</ul>
<p>Todo esse processo √© feito dentro da fun√ß√£o **_webScraping_Position(x)_** e, inicialmente, √© estruturado um dicion√°rio com o nome <b>ids_times()</b>, respons√°vel por associar o time que se deseja realizar a pesquisa com sua identifica√ß√£o √∫nica no site, que ser√° chamado na vari√°vel <b>url_link</b>, a qual receber√° o endere√ßo padr√£o do site, com o final sendo a parte que difere cada time e, para realiz√°-la, √© chamado a posi√ß√£o <b>x</b> do dicion√°rio (nome do time, par√¢metro da fun√ß√£o em pauta), que concatenar√° o ID ao restante do link.</p>
<p>Na sequ√™ncia √© feita a requisi√ß√£o no site que se deseja obter os dados e assim, todo o conte√∫do HTML √© transferido para uma vari√°vel auxiliar, sendo um array de dataframes, divididos pelas tabelas. Em seguida, a tabela correta √© transferida para uma vari√°vel que ser√° utilizada para realizar o tratamento dos dados. O tratamento foi pensado visando obter somente as informa√ß√µes necess√°rias, al√©m da identifica√ß√£o da temporada e da pontua√ß√£o, apenas por quest√£o de controle e organiza√ß√£o, ao salvar os dados no arquivo .xlsx. Sendo assim, foram selecionados tr√™s colunas, que foram posteriormente renomeadas para melhor visualiza√ß√£o, sendo elas a <b>Temporada</b>, <b>Pontos</b> e <b>Coloca√ß√£o</b>, sendo a coloca√ß√£o a que de fato seria utilizada. Por fim, os dados s√£o salvos no arquivo, assim como anteriormente citado, e a fun√ß√£o tem como retorno a chamada para uma outra fun√ß√£o, **_arithmeticsPositionAverage(var)_**, a qual ser√° respons√°vel por realizar a aritm√©tica desejada utilizando os dados obtidos. A fun√ß√£o de retorno ser√° explicada em seguida, logo ap√≥s a apresenta√ß√£o do c√≥digo que acabara de ser mencionado.</p>
<div class="fragment"><div class="line">def webScraping_position(x):</div>
<div class="line">    ids_times = {&#39;palmeiras&#39;: &#39;1023&#39;, &#39;internacional&#39;: &#39;6600&#39;, &#39;fluminense&#39;: &#39;2462&#39;, &#39;corinthians&#39;: &#39;199&#39;, &#39;flamengo&#39;: &#39;614&#39;, &#39;atletico_pr&#39;: &#39;679&#39;, &#39;atletico_mg&#39;: &#39;330&#39;, </div>
<div class="line">    &#39;america_MG&#39;: &#39;2863&#39;, &#39;sao_paulo&#39;: &#39;585&#39;, &#39;botafogo&#39;: &#39;537&#39;,&#39;fortaleza&#39;: &#39;10870&#39;, &#39;santos&#39;: &#39;221&#39;, &#39;goias&#39;: &#39;3197&#39;, &#39;bragantino&#39;: &#39;8793&#39;, &#39;coritiba&#39;: &#39;776&#39;, </div>
<div class="line">    &#39;cuiaba&#39;: &#39;28022&#39;, &#39;ceara&#39;: &#39;2029&#39;, &#39;atletico_go&#39;: &#39;15172&#39;, &#39;avai&#39;: &#39;2035&#39;, &#39;juventude&#39;: &#39;10492&#39;}</div>
<div class="line"> </div>
<div class="line">    header = {</div>
<div class="line">        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.75 Safari/537.36&quot;,</div>
<div class="line">        &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    url_link = &quot;https://www.transfermarkt.com.br/standart-team/platzierungen/verein/&quot; + ids_times[x]</div>
<div class="line"> </div>
<div class="line">    req = requests.get(url_link, headers = header)</div>
<div class="line">    df = pd.read_html(req.text)</div>
<div class="line">    stats = df[1].copy()</div>
<div class="line">    stats = stats[[&#39;Temporada&#39;, &#39;Pontos&#39;, &#39;Liga.2&#39;]]</div>
<div class="line">    stats = stats.rename(columns={&#39;Temporada&#39;: &#39;Temporada&#39;, &#39;Pontos&#39;: &#39;Coloca√ß√£o&#39;, &#39;Liga.2&#39;: &#39;Divis√£o&#39;})</div>
<div class="line">    stats.to_excel(&quot;position/&quot; + x + &quot;.xlsx&quot;)</div>
<div class="line"> </div>
<div class="line">    return (arithmeticsPositionAverage(stats))</div>
</div><!-- fragment --><p>Tendo os dados sido coletados, parte ao ponto de realizar as opera√ß√µes com as informa√ß√µes de forma que elas sejam condizentes com a realidade atual, haja visto que os dados voltam s√£o coletados sobre os √∫ltimos 5 anos. A forma encontrada para manter os dados mais realistas poss√≠veis foi por meio de uma m√©dia ponderada, juntamente a algumas outras exce√ß√µes que foram tratadas como forma de manter a integridade do programa:</p>
<p>Basicamente, foram dados pesos regressivos √† medida que os anos passaram, quanto mais atual, maior o peso da coloca√ß√£o, baseado em quantos dados se tem de um determinado time. Ap√≥s as coletas de dados, foi realizado um teste envolvendo todos os times que seriam analisados, a fim de visualizar qual o dado mais antigo que se tem para cada um. Mediante a tal an√°lise, foi poss√≠vel ter a certeza de que o time com mais dados tinha 17 coloca√ß√µes passadas. Ademais, foi poss√≠vel perceber que determinados times n√£o possuiam essa mesma quantidade devido ao fator de n√£o estarem entre as principais ligas do Campeonato Brasileiro, sendo elas S√©rie A e S√©rie B, jogando ainda as classificat√≥rias, as quais n√£o foram abordadas pelo site. Devido √† essa situa√ß√£o, para os times que n√£o possuiam essa mesma quantidade de dados, foi atribuido a coloca√ß√£o 20¬∫, assumindo que o time ficaria na √∫ltima coloca√ß√£o, devido √† grande discrep√¢ncia (S√©rie A vs S√©rie C+). Ainda √© plaus√≠vel salientar que, para os times com coloca√ß√µes na segunda divis√£o, foi atribu√≠da a coloca√ß√£o 16¬∫, desconsiderando a coloca√ß√£o obtida na s√©rie B, como uma forma de, novamente, parear para como se estivessem jogando na primeira divis√£o do futebol brasileiro. Por fim, aritm√©tica seguiu a seguinte regra, se estendendo at√© o ano de 2005:</p>
<table align="center">
<tr>
<td><b>Temporada</b> </td><td><b>Peso</b>  </td></tr>
<tr>
<td>2021 </td><td>1  </td></tr>
<tr>
<td>2020 </td><td>16/17  </td></tr>
<tr>
<td>2019 </td><td>15/17  </td></tr>
<tr>
<td>2018 </td><td>14/17  </td></tr>
<tr>
<td>2017 </td><td>13/17  </td></tr>
</table>
<p>Agora, partindo para como foi para, de fato, implementar a ideia, inicialmente foi utilizada uma vari√°vel para salvar qual era o √∫ltimo index v√°lido, haja visto que ele representaria a quantidade de anos em que os valores foram coletados. Portanto, a vari√°vel <b>boundary</b> recebeu o valor de **_stats.last_valid_index() + 1_**, sendo stats o dataframe obtido a partir da fun√ß√£o mencionada anteriormente. O motivo do +1 ao final √© devido ao index come√ßar de 0, e deseja-se iniciar a contagem assim como se realiza fora do √¢mbito da programa√ß√£o (come√ßando de 1), a fim de obter mais controle. Na sequ√™ncia, essa vari√°vel passa por uma condicional e, caso a mesma seja diferente de 17 (n√£o tenha dados de todos os anos), ter√° um tratamento diferente em situa√ß√£o posterior.</p>
<p>Seguindo, chega ao ponto que √© estruturado o denominador, sendo ele o somat√≥rio de todos os pesos utilizados para o numerador. Para tal, √© utilizado um looping <b>for</b> simples, num range que vai de 1 a 18, fazendo com que o denominador seja igual a ele mesmo somado a $\frac{j}{17}$, que vai sendo iterado at√© chegar ao peso final 1.</p>
<p>Tendo o valor do denominador, resta somente obter o valor do numerador e, a fim de seguir o que foi supracitado sobre as coloca√ß√µes e divis√µes, foi utilizada a vari√°vel <b>lvi</b> que tem valor inicial igual a 17, que ser√° decrementada a media que as temporadas forem passando, a fim de seguir o que foi visualizado na tabela acima, al√©m de tr√™s condicionais que foram utilizadas dentro de um looping <b>for</b>, num range que vai de 0 a 17 para a vari√°vel "i", buscando aplicar a m√©dia ponderada e obter, finalmente a "classifica√ß√£o geral" do time:</p>
<ul>
<li>Caso "i" seja menor que <b>boundary</b> e a "divis√£o" seja diferente de "Segunda Divis√£o", significa que h√° dados sobre o time na primeira divis√£o no determinado ano e assim<ul>
<li>Numerador ser√° igual a ele mesmo somado a $colocacao * \frac{lvi}{17}$;</li>
</ul>
</li>
<li>Caso "i" seja menor que <b>boundary</b> e a "divis√£o" seja igual a "Segunda Divis√£o", significa que h√° dados sobre o time na segunda divis√£o no determinado ano e assim<ul>
<li>Numerador ser√° igual a ele mesmo somado a $\frac{16 * lvi}{17}$;</li>
</ul>
</li>
<li>Caso "i" seja maior ou igual a <b>boundary</b>, significa que n√£o h√° dados sobre o time seja na primeira ou segunda divis√£o no determinado ano, e assim<ul>
<li>Numerador ser√° igual a ele mesmo somado a $\frac{20 * lvi}{17}$;</li>
</ul>
</li>
</ul>
<p>Ainda h√° de salientar que, ao final de cada itera√ß√£o, <b>lvi</b> √© decrementado em 1. Por fim, a fun√ß√£o retorna o valor de $\frac{numerador}{denumerador}$ para onde a fun√ß√£o foi chamada. Veja abaixo como a fun√ß√£o foi implementada:</p>
<div class="fragment"><div class="line">def arithmeticsPositionAverage(stats):</div>
<div class="line">    boundary = stats.last_valid_index() + 1</div>
<div class="line">    lvi = 17</div>
<div class="line"> </div>
<div class="line">    numerator = 0</div>
<div class="line">    j = 1</div>
<div class="line">    denominator = 0</div>
<div class="line"> </div>
<div class="line">    for j in range(18):</div>
<div class="line">        denominator = denominator + (j/17)</div>
<div class="line"> </div>
<div class="line">    for i in range(17):</div>
<div class="line">        if i &lt; (boundary) and stats[&#39;Divis√£o&#39;].iloc[i] != &quot;Segunda Divis√£o&quot;:</div>
<div class="line">            numerator = numerator + (stats[&#39;Coloca√ß√£o&#39;].iloc[i] * (lvi / 17))</div>
<div class="line">        elif i &lt; (boundary) and stats[&#39;Divis√£o&#39;].iloc[i] == &quot;Segunda Divis√£o&quot;:</div>
<div class="line">            numerator = numerator + (16 * (lvi / 17))</div>
<div class="line">        elif i &gt;= boundary:</div>
<div class="line">            numerator = numerator + (20 * (lvi / 17))</div>
<div class="line"> </div>
<div class="line">        lvi = lvi - 1</div>
<div class="line"> </div>
<div class="line">    return (numerator/denominator)</div>
</div><!-- fragment --><p>Agora chega ao ponto onde tudo √© comutado a fim de que o programa de fato aconte√ßa. Na "main", existem dois dicion√°rios, sendo um deles voltado para enviar a fun√ß√µes os exatos nomes utilizados para obter o ID correto dos times ap√≥s serem digitados por meio do Menu, sendo ele o <b>team_codes</b>, junto ao <b>team_output_names</b>, utilizado com o prop√≥sito de, a partir da sele√ß√£o no Menu, ser capaz de usar o nome do time como output de uma forma mais agrad√°vel visualmente, al√©m de condizente com o portugu√™s escrito. Aliado a isso, h√° uma lista com o nome de todos os times escritos assim como no primeiro dicion√°rio, a fim de passar tamb√©m para a fun√ß√£o com a correta gram√°tica para encontrar a p√°gina correta do time durante o Web Scraping, com o nome de <b>graph_names</b>.</p>
<p>Para o in√≠cio da implementa√ß√£o, ainda √© desginado um novo dicion√°rio, entretanto ainda vazio, com o nomve de <b>average_positions</b>. Com tudo isso sendo dito, √© iniciado um looping <b>for</b>, que itera por todos os elementos da lista supracitada, chamando a fun√ß√£o para fazer o Web Scraping para cada "i", sendo ele o nome dos times, utilizando o pr√≥prio nome como a chave para o dicion√°iro acima, sendo o valor da chave, a m√©dia encontrada pelo programa.</p>
<p>A esse ponto, v√™m a necessidade de explicar como os <b>Grafos</b> ser√£o usados para essa aplica√ß√£o:</p><ul>
<li>Cada time ser√° um v√©rtice, e eles ser√£o ligados de forma que, caso o time A tenha uma m√©dia <b>MENOR</b> do que a m√©dia do time B, uma aresta "sair√°" de A e "entrar√°" em B, indicando que A tem maior probabilidade de ganhar a partida do que B.</li>
<li>Todos os times ser√£o comparados com todos,, mesmo que nem todos eles sejam usados, de forma que, uma vez que o programa esteja pronto para uso, todas as a√ß√µes tomadas dentro do mesmo sejam instant√¢neas.</li>
</ul>
<p>√â criado um grafo direcionado, utilizando a biblioteca **_networkx_** e nele s√£o adicionados todos os n√≥s desejados, sendo eles os times utilizados e presentes na lista <b>graph_names</b> (inclusive esse √© o motivo da mesma ter esse nome). Em sequ√™ncia, √© utilizado o m√©todo da bolha, a fim de comparar todos os valores entre si. Nele, √© utilizado as informa√ß√µes do <b>average_positions</b>, e visualizado se a m√©dia do time em <b>average_positions</b>, com a chave <b>graph_names</b> em <b>i</b>, √© maior que o mesmo direcionamento, por√©m trocando <b>i</b> por <b>j</b>:</p><ul>
<li>Caso seja, ser√° adicionado uma aresta, saindo do v√©rtice <b>graph_names[i]</b> para <b>graph_names[j]</b>;</li>
<li>Caso contr√°rio, sair√° de <b>graph_names[j]</b> para <b>graph_names[i]</b>.</li>
</ul>
<p>Com as informa√ß√µes todas salvas, um menu ser√° inserido na tela do usu√°rio, dando op√ß√µes de times para escolher e realizar as compara√ß√µes, al√©m de um adendo para caso dseje sair do programa, sendo necess√°rio apenas digitar o n√∫mero para time igual, tanto no primeiro, quanto no segundo.</p>
<p>Ap√≥s esse processo, caso seja de desejo do usu√°rio visualizar o Grafo, o programa perguntar√°, bastando digitar <b>1</b> quando solicitado, se n√£o, digitando <b>2</b>, ser√° finalizado sem o display.</p>
<h2 align="center">üñ®Ô∏è <b> <em>Exemplo de Execu√ß√£o</em> </b> </h2>
<p>Ap√≥s executar corretamente o programa, o que se deve esperar √© um menu como esse, contando com dois inputs por conta do usu√°rio e, logo em seguida, o resultado para o confronto em quest√£o:</p>
<p align="center"></p>
<p><img src="imgs/execu√ß√£oexemplo.jpeg" alt="" width="800px" class="inline"/> </p>
<p>Ao finalizar a execu√ß√£o do looping, o menu abaixo ser√° disponibilizado ao usu√°rio:</p>
<p align="center"></p>
<p><img src="imgs/menufinal.png" alt="" width="400px" class="inline"/> </p>
<p>E caso a op√ß√£o selecionada seja a primeira, um grafo desse padr√£o ser√° gerado para posterior visualiza√ß√£o do usu√°rio:</p>
<p align="center"></p>
<p><img src="imgs/graph.jpeg" alt="" width="800px" class="inline"/> </p>
<h2 align="center">üîß <b> <em> Execu√ß√£o </em> <br  />
 </b> </h2>
<p align="center">Inicialmente, verifique se todas as bibliotecas est√£o coerentes com as apresentadas no t√≥pico Tecnologias Utilizadas, abra o console na pasta do reposit√≥rio e siga com o comando: </p>
<p><b> python3 main.py</b></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
