\doxysection*{Previs√µes utilizando Grafos }

Este reposit√≥rio cont√©m a implementa√ß√£o de uma forma primitiva e amadora de realizar previs√µes sobre qual time sairia vencedor em uma partida de futebol, envolvendo todos os times presentes na s√©rie A.

\doxysubsection*{‚ö†Ô∏è {\bfseries{ {\itshape  Problem√°tica } }} }

Sabe-\/se que no futebol, uma das grandes ind√∫strias que crescem √© voltada para o mercado de apostas, sendo uma fonte consideravelmente forte de renda extra. Entretanto, enquanto humanos, √© comum desconsiderar alguns fatores essenciais ao realizar uma aposta por puro esquecimento de estat√≠stica X ou Y. Pensando nisso, o programa foi criado como uma forma de juntar todas as estat√≠sticas importantes para o processo de decis√£o para um resultado, apresentando uma previs√£o decidida por meio da an√°lise de todas as informa√ß√µes coletadas por meio de sites voltados ao mundo futibol√≠stico.

\doxysubsection*{‚öôÔ∏è {\bfseries{ {\itshape Tecnologias utilizadas} }} }

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
{\bfseries{Tecnologia}} &{\bfseries{Vers√£o}}  \\\cline{1-2}
Python &3.\+10.\+6  \\\cline{1-2}
pandas &1.\+5.\+1  \\\cline{1-2}
numpy &1.\+23.\+4  \\\cline{1-2}
requests &2.\+28.\+1  \\\cline{1-2}
lxml &4.\+9.\+1  \\\cline{1-2}
openpyxl &3.\+0.\+10  \\\cline{1-2}
networkx &2.\+8.\+8  \\\cline{1-2}
matplotlib &3.\+6.\+2  \\\cline{1-2}
\end{longtabu}


\doxysubsection*{üî¨ {\bfseries{ {\itshape Dados levados em considera√ß√£o} }} }

Essa √© a vers√£o inicial de um projeto que poss√≠velmente pode ter sequ√™ncia, sendo assim, o programa conta com apenas um tipo de dado levado em considera√ß√£o\+:
\begin{DoxyItemize}
\item Coloca√ß√µes nos 5 anos anteriores da competi√ß√£o.
\end{DoxyItemize}

√â plaus√≠vel ainda salientar que houve o desejo de adicionar o m√©rito do confronto direto entre ambos os times que estariam em duelo, entretanto, a fonte encontrada para a desejada informa√ß√£o n√£o aceitava a quantidade de requisi√ß√µes necess√°rias pelo programa. Ao entrar em contato com o site em quest√£o, solicitando uma libera√ß√£o ou se havia a exist√™ncia de uma API, n√£o houve retorno.

\doxysubsection*{üí°{\bfseries{ {\itshape Algoritmo } }} }

$<$d1$>$ 

1. Realizar a coleta de informa√ß√µes desejadas por meio de Web Scraping;  

2. Salvar as informa√ß√µes no programa para uso posterior;  

3. Aplicar a aritm√©tica considerada eficiente aos dados coletados;  

4. Utilizar grafos a fim de organizar as informa√ß√µes da forma desejada;  

5. Solicitar ao usu√°rio que informe qual ser√° o confronto;  

6. Informar ao usu√°rio qual o time que {\bfseries{PROVAVELMENTE}} vencer√° o confronto, utilizando os dados j√° armazenados no programa.  $<$/d1$>$

\doxysubsection*{üñ•Ô∏è{\bfseries{ {\itshape Implementa√ß√£o} }} }

Inicialmente, seguindo o que foi pontuado no detalhamento do algoritmo, o primeiro passo foi realizar a coleta de informa√ß√µes. Para esse est√°gio, foram utilizadas as bibliotecas {\bfseries{pandas}}, {\bfseries{requests}}, {\bfseries{openpyxl}} e {\bfseries{lxml}}, sendo cada uma delas extremamente importante para cada fase dessa coleta\+:
\begin{DoxyItemize}
\item {\bfseries{Pandas}} ser√° utilizado a fim de trabalhar com todo o conte√∫do HTML em dataframes;
\item {\bfseries{Requests}} foi utilizado como uma forma segura de realizar as requisi√ß√µes para o Web Scraping a fim de minimizar as chances de erros;
\item {\bfseries{Openpyxl}} e {\bfseries{lxml}} serviu o prop√≥sito de salvar todos os dados coletados, ap√≥s serem tratados, em arquivos $\ast$$\ast$.xlsx$\ast$$\ast$.
\end{DoxyItemize}

Todo esse processo √© feito dentro da fun√ß√£o $\ast$$\ast$\+\_\+web\+Scraping\+\_\+\+Position(x)\+\_\+$\ast$$\ast$ e, inicialmente, √© estruturado um dicion√°rio com o nome {\bfseries{ids\+\_\+times()}}, respons√°vel por associar o time que se deseja realizar a pesquisa com sua identifica√ß√£o √∫nica no site, que ser√° chamado na vari√°vel {\bfseries{url\+\_\+link}}, a qual receber√° o endere√ßo padr√£o do site, com o final sendo a parte que difere cada time e, para realiz√°-\/la, √© chamado a posi√ß√£o {\bfseries{x}} do dicion√°rio (nome do time, par√¢metro da fun√ß√£o em pauta), que concatenar√° o ID ao restante do link.

Na sequ√™ncia √© feita a requisi√ß√£o no site que se deseja obter os dados e assim, todo o conte√∫do HTML √© transferido para uma vari√°vel auxiliar, sendo um array de dataframes, divididos pelas tabelas. Em seguida, a tabela correta √© transferida para uma vari√°vel que ser√° utilizada para realizar o tratamento dos dados. O tratamento foi pensado visando obter somente as informa√ß√µes necess√°rias, al√©m da identifica√ß√£o da temporada e da pontua√ß√£o, apenas por quest√£o de controle e organiza√ß√£o, ao salvar os dados no arquivo .xlsx. Sendo assim, foram selecionados tr√™s colunas, que foram posteriormente renomeadas para melhor visualiza√ß√£o, sendo elas a {\bfseries{Temporada}}, {\bfseries{Pontos}} e {\bfseries{Coloca√ß√£o}}, sendo a coloca√ß√£o a que de fato seria utilizada. Por fim, os dados s√£o salvos no arquivo, assim como anteriormente citado, e a fun√ß√£o tem como retorno a chamada para uma outra fun√ß√£o, $\ast$$\ast$\+\_\+arithmetics\+Position\+Average(var)\+\_\+$\ast$$\ast$, a qual ser√° respons√°vel por realizar a aritm√©tica desejada utilizando os dados obtidos. A fun√ß√£o de retorno ser√° explicada em seguida, logo ap√≥s a apresenta√ß√£o do c√≥digo que acabara de ser mencionado.


\begin{DoxyCode}{0}
\DoxyCodeLine{def webScraping\_position(x):}
\DoxyCodeLine{    ids\_times = \{'palmeiras': '1023', 'internacional': '6600', 'fluminense': '2462', 'corinthians': '199', 'flamengo': '614', 'atletico\_pr': '679', 'atletico\_mg': '330', }
\DoxyCodeLine{    'america\_MG': '2863', 'sao\_paulo': '585', 'botafogo': '537','fortaleza': '10870', 'santos': '221', 'goias': '3197', 'bragantino': '8793', 'coritiba': '776', }
\DoxyCodeLine{    'cuiaba': '28022', 'ceara': '2029', 'atletico\_go': '15172', 'avai': '2035', 'juventude': '10492'\}}
\DoxyCodeLine{}
\DoxyCodeLine{    header = \{}
\DoxyCodeLine{        "{}User-\/Agent"{}: "{}Mozilla/5.0 (X11; Linux x86\_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.75 Safari/537.36"{},}
\DoxyCodeLine{        "{}X-\/Requested-\/With"{}: "{}XMLHttpRequest"{}}
\DoxyCodeLine{    \}}
\DoxyCodeLine{}
\DoxyCodeLine{    url\_link = "{}https://www.transfermarkt.com.br/standart-\/team/platzierungen/verein/"{} + ids\_times[x]}
\DoxyCodeLine{}
\DoxyCodeLine{    req = requests.get(url\_link, headers = header)}
\DoxyCodeLine{    df = pd.read\_html(req.text)}
\DoxyCodeLine{    stats = df[1].copy()}
\DoxyCodeLine{    stats = stats[['Temporada', 'Pontos', 'Liga.2']]}
\DoxyCodeLine{    stats = stats.rename(columns=\{'Temporada': 'Temporada', 'Pontos': 'Coloca√ß√£o', 'Liga.2': 'Divis√£o'\})}
\DoxyCodeLine{    stats.to\_excel("{}position/"{} + x + "{}.xlsx"{})}
\DoxyCodeLine{}
\DoxyCodeLine{    return (arithmeticsPositionAverage(stats))}

\end{DoxyCode}


Tendo os dados sido coletados, parte ao ponto de realizar as opera√ß√µes com as informa√ß√µes de forma que elas sejam condizentes com a realidade atual, haja visto que os dados voltam s√£o coletados sobre os √∫ltimos 5 anos. A forma encontrada para manter os dados mais realistas poss√≠veis foi por meio de uma m√©dia ponderada, juntamente a algumas outras exce√ß√µes que foram tratadas como forma de manter a integridade do programa\+:

Basicamente, foram dados pesos regressivos √† medida que os anos passaram, quanto mais atual, maior o peso da coloca√ß√£o, baseado em quantos dados se tem de um determinado time. Ap√≥s as coletas de dados, foi realizado um teste envolvendo todos os times que seriam analisados, a fim de visualizar qual o dado mais antigo que se tem para cada um. Mediante a tal an√°lise, foi poss√≠vel ter a certeza de que o time com mais dados tinha 17 coloca√ß√µes passadas. Ademais, foi poss√≠vel perceber que determinados times n√£o possuiam essa mesma quantidade devido ao fator de n√£o estarem entre as principais ligas do Campeonato Brasileiro, sendo elas S√©rie A e S√©rie B, jogando ainda as classificat√≥rias, as quais n√£o foram abordadas pelo site. Devido √† essa situa√ß√£o, para os times que n√£o possuiam essa mesma quantidade de dados, foi atribuido a coloca√ß√£o 20¬∫, assumindo que o time ficaria na √∫ltima coloca√ß√£o, devido √† grande discrep√¢ncia (S√©rie A vs S√©rie C+). Ainda √© plaus√≠vel salientar que, para os times com coloca√ß√µes na segunda divis√£o, foi atribu√≠da a coloca√ß√£o 16¬∫, desconsiderando a coloca√ß√£o obtida na s√©rie B, como uma forma de, novamente, parear para como se estivessem jogando na primeira divis√£o do futebol brasileiro. Por fim, aritm√©tica seguiu a seguinte regra, se estendendo at√© o ano de 2005\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
{\bfseries{Temporada}} &{\bfseries{Peso}}  \\\cline{1-2}
2021 &1  \\\cline{1-2}
2020 &16/17  \\\cline{1-2}
2019 &15/17  \\\cline{1-2}
2018 &14/17  \\\cline{1-2}
2017 &13/17  \\\cline{1-2}
\end{longtabu}


Agora, partindo para como foi para, de fato, implementar a ideia, inicialmente foi utilizada uma vari√°vel para salvar qual era o √∫ltimo index v√°lido, haja visto que ele representaria a quantidade de anos em que os valores foram coletados. Portanto, a vari√°vel {\bfseries{boundary}} recebeu o valor de $\ast$$\ast$\+\_\+stats.last\+\_\+valid\+\_\+index() + 1\+\_\+$\ast$$\ast$, sendo stats o dataframe obtido a partir da fun√ß√£o mencionada anteriormente. O motivo do +1 ao final √© devido ao index come√ßar de 0, e deseja-\/se iniciar a contagem assim como se realiza fora do √¢mbito da programa√ß√£o (come√ßando de 1), a fim de obter mais controle. Na sequ√™ncia, essa vari√°vel passa por uma condicional e, caso a mesma seja diferente de 17 (n√£o tenha dados de todos os anos), ter√° um tratamento diferente em situa√ß√£o posterior.

Seguindo, chega ao ponto que √© estruturado o denominador, sendo ele o somat√≥rio de todos os pesos utilizados para o numerador. Para tal, √© utilizado um looping {\bfseries{for}} simples, num range que vai de 1 a 18, fazendo com que o denominador seja igual a ele mesmo somado a \$\textbackslash{}frac\{j\}\{17\}\$, que vai sendo iterado at√© chegar ao peso final 1.

Tendo o valor do denominador, resta somente obter o valor do numerador e, a fim de seguir o que foi supracitado sobre as coloca√ß√µes e divis√µes, foi utilizada a vari√°vel {\bfseries{lvi}} que tem valor inicial igual a 17, que ser√° decrementada a media que as temporadas forem passando, a fim de seguir o que foi visualizado na tabela acima, al√©m de tr√™s condicionais que foram utilizadas dentro de um looping {\bfseries{for}}, num range que vai de 0 a 17 para a vari√°vel \char`\"{}i\char`\"{}, buscando aplicar a m√©dia ponderada e obter, finalmente a \char`\"{}classifica√ß√£o geral\char`\"{} do time\+:


\begin{DoxyItemize}
\item Caso \char`\"{}i\char`\"{} seja menor que {\bfseries{boundary}} e a \char`\"{}divis√£o\char`\"{} seja diferente de \char`\"{}\+Segunda Divis√£o\char`\"{}, significa que h√° dados sobre o time na primeira divis√£o no determinado ano e assim
\begin{DoxyItemize}
\item Numerador ser√° igual a ele mesmo somado a \$colocacao $\ast$ \textbackslash{}frac\{lvi\}\{17\}\$;
\end{DoxyItemize}
\item Caso \char`\"{}i\char`\"{} seja menor que {\bfseries{boundary}} e a \char`\"{}divis√£o\char`\"{} seja igual a \char`\"{}\+Segunda Divis√£o\char`\"{}, significa que h√° dados sobre o time na segunda divis√£o no determinado ano e assim
\begin{DoxyItemize}
\item Numerador ser√° igual a ele mesmo somado a \$\textbackslash{}frac\{16 $\ast$ lvi\}\{17\}\$;
\end{DoxyItemize}
\item Caso \char`\"{}i\char`\"{} seja maior ou igual a {\bfseries{boundary}}, significa que n√£o h√° dados sobre o time seja na primeira ou segunda divis√£o no determinado ano, e assim
\begin{DoxyItemize}
\item Numerador ser√° igual a ele mesmo somado a \$\textbackslash{}frac\{20 $\ast$ lvi\}\{17\}\$;
\end{DoxyItemize}
\end{DoxyItemize}

Ainda h√° de salientar que, ao final de cada itera√ß√£o, {\bfseries{lvi}} √© decrementado em 1. Por fim, a fun√ß√£o retorna o valor de \$\textbackslash{}frac\{numerador\}\{denumerador\}\$ para onde a fun√ß√£o foi chamada. Veja abaixo como a fun√ß√£o foi implementada\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{def arithmeticsPositionAverage(stats):}
\DoxyCodeLine{    boundary = stats.last\_valid\_index() + 1}
\DoxyCodeLine{    lvi = 17}
\DoxyCodeLine{}
\DoxyCodeLine{    numerator = 0}
\DoxyCodeLine{    j = 1}
\DoxyCodeLine{    denominator = 0}
\DoxyCodeLine{}
\DoxyCodeLine{    for j in range(18):}
\DoxyCodeLine{        denominator = denominator + (j/17)}
\DoxyCodeLine{}
\DoxyCodeLine{    for i in range(17):}
\DoxyCodeLine{        if i < (boundary) and stats['Divis√£o'].iloc[i] != "{}Segunda Divis√£o"{}:}
\DoxyCodeLine{            numerator = numerator + (stats['Coloca√ß√£o'].iloc[i] * (lvi / 17))}
\DoxyCodeLine{        elif i < (boundary) and stats['Divis√£o'].iloc[i] == "{}Segunda Divis√£o"{}:}
\DoxyCodeLine{            numerator = numerator + (16 * (lvi / 17))}
\DoxyCodeLine{        elif i >= boundary:}
\DoxyCodeLine{            numerator = numerator + (20 * (lvi / 17))}
\DoxyCodeLine{}
\DoxyCodeLine{        lvi = lvi -\/ 1}
\DoxyCodeLine{}
\DoxyCodeLine{    return (numerator/denominator)}

\end{DoxyCode}


Agora chega ao ponto onde tudo √© comutado a fim de que o programa de fato aconte√ßa. Na \char`\"{}main\char`\"{}, existem dois dicion√°rios, sendo um deles voltado para enviar a fun√ß√µes os exatos nomes utilizados para obter o ID correto dos times ap√≥s serem digitados por meio do Menu, sendo ele o {\bfseries{team\+\_\+codes}}, junto ao {\bfseries{team\+\_\+output\+\_\+names}}, utilizado com o prop√≥sito de, a partir da sele√ß√£o no Menu, ser capaz de usar o nome do time como output de uma forma mais agrad√°vel visualmente, al√©m de condizente com o portugu√™s escrito. Aliado a isso, h√° uma lista com o nome de todos os times escritos assim como no primeiro dicion√°rio, a fim de passar tamb√©m para a fun√ß√£o com a correta gram√°tica para encontrar a p√°gina correta do time durante o Web Scraping, com o nome de {\bfseries{graph\+\_\+names}}.

Para o in√≠cio da implementa√ß√£o, ainda √© desginado um novo dicion√°rio, entretanto ainda vazio, com o nomve de {\bfseries{average\+\_\+positions}}. Com tudo isso sendo dito, √© iniciado um looping {\bfseries{for}}, que itera por todos os elementos da lista supracitada, chamando a fun√ß√£o para fazer o Web Scraping para cada \char`\"{}i\char`\"{}, sendo ele o nome dos times, utilizando o pr√≥prio nome como a chave para o dicion√°iro acima, sendo o valor da chave, a m√©dia encontrada pelo programa.

A esse ponto, v√™m a necessidade de explicar como os {\bfseries{Grafos}} ser√£o usados para essa aplica√ß√£o\+:
\begin{DoxyItemize}
\item Cada time ser√° um v√©rtice, e eles ser√£o ligados de forma que, caso o time A tenha uma m√©dia {\bfseries{MENOR}} do que a m√©dia do time B, uma aresta \char`\"{}sair√°\char`\"{} de A e \char`\"{}entrar√°\char`\"{} em B, indicando que A tem maior probabilidade de ganhar a partida do que B.
\item Todos os times ser√£o comparados com todos,, mesmo que nem todos eles sejam usados, de forma que, uma vez que o programa esteja pronto para uso, todas as a√ß√µes tomadas dentro do mesmo sejam instant√¢neas.
\end{DoxyItemize}

√â criado um grafo direcionado, utilizando a biblioteca $\ast$$\ast$\+\_\+networkx\+\_\+$\ast$$\ast$ e nele s√£o adicionados todos os n√≥s desejados, sendo eles os times utilizados e presentes na lista {\bfseries{graph\+\_\+names}} (inclusive esse √© o motivo da mesma ter esse nome). Em sequ√™ncia, √© utilizado o m√©todo da bolha, a fim de comparar todos os valores entre si. Nele, √© utilizado as informa√ß√µes do {\bfseries{average\+\_\+positions}}, e visualizado se a m√©dia do time em {\bfseries{average\+\_\+positions}}, com a chave {\bfseries{graph\+\_\+names}} em {\bfseries{i}}, √© maior que o mesmo direcionamento, por√©m trocando {\bfseries{i}} por {\bfseries{j}}\+:
\begin{DoxyItemize}
\item Caso seja, ser√° adicionado uma aresta, saindo do v√©rtice {\bfseries{graph\+\_\+names\mbox{[}i\mbox{]}}} para {\bfseries{graph\+\_\+names\mbox{[}j\mbox{]}}};
\item Caso contr√°rio, sair√° de {\bfseries{graph\+\_\+names\mbox{[}j\mbox{]}}} para {\bfseries{graph\+\_\+names\mbox{[}i\mbox{]}}}.
\end{DoxyItemize}

Com as informa√ß√µes todas salvas, um menu ser√° inserido na tela do usu√°rio, dando op√ß√µes de times para escolher e realizar as compara√ß√µes, al√©m de um adendo para caso dseje sair do programa, sendo necess√°rio apenas digitar o n√∫mero para time igual, tanto no primeiro, quanto no segundo.

Ap√≥s esse processo, caso seja de desejo do usu√°rio visualizar o Grafo, o programa perguntar√°, bastando digitar {\bfseries{1}} quando solicitado, se n√£o, digitando {\bfseries{2}}, ser√° finalizado sem o display.

\doxysubsection*{üñ®Ô∏è {\bfseries{ {\itshape Exemplo de Execu√ß√£o} }} }

Ap√≥s executar corretamente o programa, o que se deve esperar √© um menu como esse, contando com dois inputs por conta do usu√°rio e, logo em seguida, o resultado para o confronto em quest√£o\+:



 

Ao finalizar a execu√ß√£o do looping, o menu abaixo ser√° disponibilizado ao usu√°rio\+:



 

E caso a op√ß√£o selecionada seja a primeira, um grafo desse padr√£o ser√° gerado para posterior visualiza√ß√£o do usu√°rio\+:



 

\doxysubsection*{üîß {\bfseries{ {\itshape  Execu√ß√£o } ~\newline
 }} }

Inicialmente, verifique se todas as bibliotecas est√£o coerentes com as apresentadas no t√≥pico Tecnologias Utilizadas, abra o console na pasta do reposit√≥rio e siga com o comando\+: 

{\bfseries{ python3 main.\+py}}